use crate::enum_builder;
use crate::enums::Ability;
use crate::enums::ActorId;
use crate::enums::DialogueId;
use crate::enums::Language;
use crate::enums::MapSetupId;
use crate::enums::TextureId;
use crate::enums::WarpOrTriggerId;
use crate::enums::map::MapId;
use std::ops::Index;

pub struct WarpLair {
    pub map_id: MapId,
    pub exit_id: u16,
    pub map_setup: MapSetupId,
    pub warp_id: WarpOrTriggerId,
}

pub struct Molehill {
    pub table_index: u8,
    pub teach_text_id: DialogueId,
    pub refresher_text_id: DialogueId,
    pub ability: Ability,
}

pub struct LevelInfo {
    pub warp_entry_point: ActorId,
    pub warp_lair: WarpLair,
    pub sign_left: TextureId,
    pub sign_right: TextureId,
    pub label: [TextureId; 4],
    pub painting: [TextureId; 16],
    pub maps: &'static [MapSetupId],
    pub molehills: &'static [Molehill],
}

enum_builder! {
    #[repr(usize)]
    pub enum LevelOrder {
        MumbosMountain = 0,
        TreasureTroveCove = 1,
        ClankersCavern = 2,
        BubbleGloopSwamp = 3,
        FreezeezyPeak = 4,
        Lair = 5,
        GobisValley = 6,
        ClickClockWood = 7,
        RustyBucketBay = 8,
        MadMonsterMansion = 9,
    }
}

impl LevelOrder {
    pub fn has_molehill(&self) -> bool {
        self.molehill_count() > 0
    }

    pub fn molehill_count(&self) -> usize {
        LEVELS_INFO[*self].molehills.len()
    }

    pub fn get_name(&self, lang: Language) -> &'static str {
        match self {
            LevelOrder::MumbosMountain => match lang {
                Language::German | Language::English => "MUMBO'S MOUNTAIN",
                Language::Japanese => "",
                Language::French => "LA MONTAGNE DE MUMBO",
                Language::Unknown(_) => todo!(),
            },
            LevelOrder::TreasureTroveCove => match lang {
                Language::German | Language::English => "TREASURE TROVE COVE",
                Language::Japanese => "",
                Language::French => "LA BAIE DU TRÉSOR",
                Language::Unknown(_) => todo!(),
            },
            LevelOrder::ClankersCavern => match lang {
                Language::German | Language::English => "CLANKER'S CAVERN",
                Language::Japanese => "",
                Language::French => "LA CAVERNE DE CLANKER",
                Language::Unknown(_) => todo!(),
            },
            LevelOrder::BubbleGloopSwamp => match lang {
                Language::German | Language::English => "BUBBLEGLOOP SWAMP",
                Language::Japanese => "",
                Language::French => "LE MARAIS MOISI",
                Language::Unknown(_) => todo!(),
            },
            LevelOrder::FreezeezyPeak => match lang {
                Language::German | Language::English => "FREEZEEZY PEAK",
                Language::Japanese => "",
                Language::French => "LE PIC POLAIRE",
                Language::Unknown(_) => todo!(),
            },
            LevelOrder::Lair => match lang {
                Language::English => "GRUNTILDA'S LAIR",
                Language::Japanese => "",
                Language::French => "LE REPÈRE DE GRUNTILDA",
                Language::German => "GRUNTILDAS REICH",
                Language::Unknown(_) => todo!(),
            },
            LevelOrder::GobisValley => match lang {
                Language::German | Language::English => "GOBI'S VALLEY",
                Language::Japanese => "",
                Language::French => "LA VALLÉE DE GOBI",
                Language::Unknown(_) => todo!(),
            },
            LevelOrder::ClickClockWood => match lang {
                Language::German | Language::English => "CLICK CLOCK WOOD",
                Language::Japanese => "",
                Language::French => "LE BOIS CLIC-CLAC",
                Language::Unknown(_) => todo!(),
            },
            LevelOrder::RustyBucketBay => match lang {
                Language::German | Language::English => "RUSTY BUCKET BAY",
                Language::Japanese => "",
                Language::French => "LA BAIE DU RUSTY BUCKET",
                Language::Unknown(_) => todo!(),
            },
            LevelOrder::MadMonsterMansion => match lang {
                Language::German | Language::English => "MAD MONSTER MANSION",
                Language::Japanese => "",
                Language::French => "LE MANOIR DU MONSTRE",
                Language::Unknown(_) => todo!(),
            },
            LevelOrder::Unknown(_) => todo!(),
        }
    }
}

impl Index<LevelOrder> for [LevelInfo] {
    type Output = LevelInfo;
    fn index(&self, idx: LevelOrder) -> &Self::Output {
        let i: usize = idx.into();
        &self[i]
    }
}

pub const LAIR_MAPS: [MapSetupId; 20] = [
    MapSetupId::GlMmLobby,
    MapSetupId::GlTtcAndCcPuzzle,
    MapSetupId::Gl180NoteDoor,
    MapSetupId::GlRedCauldronRoom,
    MapSetupId::GlTtcLobby,
    MapSetupId::GlGvLobby,
    MapSetupId::GlFpLobby,
    MapSetupId::GlCcLobby,
    MapSetupId::GlStatueRoom,
    MapSetupId::GlBgsLobby,
    MapSetupId::GlGvPuzzle,
    MapSetupId::GlMmmLobby,
    MapSetupId::Gl640NoteDoor,
    MapSetupId::GlRbbLobby,
    MapSetupId::GlRbbAndMmmPuzzle,
    MapSetupId::GlCcwLobby,
    MapSetupId::GlCrypt,
    MapSetupId::GlFfEntrance,
    MapSetupId::GlFurnaceFun,
    MapSetupId::GlDingpot,
];

pub const LEVELS_INFO: [LevelInfo; 10] = [
    LevelInfo {
        warp_entry_point: ActorId::EntryPoint5,
        warp_lair: WarpLair {
            map_id: MapId::GlMmLobby,
            exit_id: 2,
            map_setup: MapSetupId::GlMmLobby,
            warp_id: WarpOrTriggerId::MmEnterLevel,
        },
        sign_left: TextureId::MmSignLeft,
        sign_right: TextureId::MmSignRight,
        label: [
            TextureId::MmLabelLeft,
            TextureId::MmLabelMiddleLeft,
            TextureId::MmLabelMiddleRight,
            TextureId::MmLabelRight,
        ],
        painting: [
            TextureId::MmPainting00,
            TextureId::MmPainting10,
            TextureId::MmPainting20,
            TextureId::MmPainting30,
            TextureId::MmPainting01,
            TextureId::MmPainting11,
            TextureId::MmPainting21,
            TextureId::MmPainting31,
            TextureId::MmPainting02,
            TextureId::MmPainting12,
            TextureId::MmPainting22,
            TextureId::MmPainting32,
            TextureId::MmPainting03,
            TextureId::MmPainting13,
            TextureId::MmPainting23,
            TextureId::MmPainting33,
        ],
        maps: &[
            MapSetupId::MumbosMountain,
            MapSetupId::TickersTower,
            MapSetupId::MmMumbosSkull,
        ],
        molehills: &[
            Molehill {
                table_index: 1,
                teach_text_id: DialogueId::BottlesLearningEggs,
                refresher_text_id: DialogueId::BottlesEggsRefresher,
                ability: Ability::Eggs,
            },
            Molehill {
                table_index: 2,
                teach_text_id: DialogueId::BottlesLearningBeakBuster,
                refresher_text_id: DialogueId::BottlesBeakBusterRefresher,
                ability: Ability::BeakBuster,
            },
            Molehill {
                table_index: 3,
                teach_text_id: DialogueId::BottlesLearningTalonTrot,
                refresher_text_id: DialogueId::BottlesTalonTrotRefresher,
                ability: Ability::TalonTrot,
            },
        ],
    },
    LevelInfo {
        warp_entry_point: ActorId::EntryPoint4,
        warp_lair: WarpLair {
            map_id: MapId::GlTtcLobby,
            exit_id: 4,
            map_setup: MapSetupId::GlTtcLobby,
            warp_id: WarpOrTriggerId::TtcEnterLevel,
        },
        sign_left: TextureId::TtcSignLeft,
        sign_right: TextureId::TtcSignRight,
        label: [
            TextureId::TtcLabelLeft,
            TextureId::TtcLabelMiddleLeft,
            TextureId::TtcLabelMiddleRight,
            TextureId::TtcLabelRight,
        ],
        painting: [
            TextureId::TtcPainting00,
            TextureId::TtcPainting10,
            TextureId::TtcPainting20,
            TextureId::TtcPainting30,
            TextureId::TtcPainting01,
            TextureId::TtcPainting11,
            TextureId::TtcPainting21,
            TextureId::TtcPainting31,
            TextureId::TtcPainting02,
            TextureId::TtcPainting12,
            TextureId::TtcPainting22,
            TextureId::TtcPainting32,
            TextureId::TtcPainting03,
            TextureId::TtcPainting13,
            TextureId::TtcPainting23,
            TextureId::TtcPainting33,
        ],
        maps: &[
            MapSetupId::TreasureTroveCove,
            MapSetupId::BlubbersShip,
            MapSetupId::NippersShell,
            MapSetupId::SharkfoodIsland,
            MapSetupId::Sandcastle,
        ],
        molehills: &[
            Molehill {
                table_index: 4,
                teach_text_id: DialogueId::BottlesLearningShockJump,
                refresher_text_id: DialogueId::BottlesShockJumpRefresher,
                ability: Ability::ShockJump,
            },
            Molehill {
                table_index: 5,
                teach_text_id: DialogueId::BottlesLearningFlight,
                refresher_text_id: DialogueId::BottlesFlightRefresher,
                ability: Ability::Flight,
            },
        ],
    },
    LevelInfo {
        warp_entry_point: ActorId::EntryPoint5,
        warp_lair: WarpLair {
            map_id: MapId::GlCcLobby,
            exit_id: 2,
            map_setup: MapSetupId::GlCcLobby,
            warp_id: WarpOrTriggerId::CcEnterLevel,
        },
        sign_left: TextureId::CcSignLeft,
        sign_right: TextureId::CcSignRight,
        label: [
            TextureId::CcLabelLeft,
            TextureId::CcLabelMiddleLeft,
            TextureId::CcLabelMiddleRight,
            TextureId::CcLabelRight,
        ],
        painting: [
            TextureId::CcPainting00,
            TextureId::CcPainting10,
            TextureId::CcPainting20,
            TextureId::CcPainting30,
            TextureId::CcPainting01,
            TextureId::CcPainting11,
            TextureId::CcPainting21,
            TextureId::CcPainting31,
            TextureId::CcPainting02,
            TextureId::CcPainting12,
            TextureId::CcPainting22,
            TextureId::CcPainting32,
            TextureId::CcPainting03,
            TextureId::CcPainting13,
            TextureId::CcPainting23,
            TextureId::CcPainting33,
        ],
        maps: &[
            MapSetupId::ClankersCavern,
            MapSetupId::CcWitchSwitchRoom,
            MapSetupId::InsideClanker,
            MapSetupId::GoldfeatherRoom,
        ],
        molehills: &[Molehill {
            table_index: 6,
            teach_text_id: DialogueId::BottlesLearningWonderwing,
            refresher_text_id: DialogueId::BottlesWonderwingRefresher,
            ability: Ability::Wonderwing,
        }],
    },
    LevelInfo {
        warp_entry_point: ActorId::EntryPoint2,
        warp_lair: WarpLair {
            map_id: MapId::GlBgsLobby,
            exit_id: 2,
            map_setup: MapSetupId::GlBgsLobby,
            warp_id: WarpOrTriggerId::BgsEnterLevel,
        },
        sign_left: TextureId::BgsSignLeft,
        sign_right: TextureId::BgsSignRight,
        label: [
            TextureId::BgsLabelLeft,
            TextureId::BgsLabelMiddleLeft,
            TextureId::BgsLabelMiddleRight,
            TextureId::BgsLabelRight,
        ],
        painting: [
            TextureId::BgsPainting00,
            TextureId::BgsPainting10,
            TextureId::BgsPainting20,
            TextureId::BgsPainting30,
            TextureId::BgsPainting01,
            TextureId::BgsPainting11,
            TextureId::BgsPainting21,
            TextureId::BgsPainting31,
            TextureId::BgsPainting02,
            TextureId::BgsPainting12,
            TextureId::BgsPainting22,
            TextureId::BgsPainting32,
            TextureId::BgsPainting03,
            TextureId::BgsPainting13,
            TextureId::BgsPainting23,
            TextureId::BgsPainting33,
        ],
        maps: &[
            MapSetupId::BubbleGloopSwamp,
            MapSetupId::MrVile,
            MapSetupId::Tiptup,
            MapSetupId::BgsMumbosSkull,
        ],
        molehills: &[Molehill {
            table_index: 7,
            teach_text_id: DialogueId::BottlesLearningWadingBoots,
            refresher_text_id: DialogueId::BottlesWadingBootsRefresher,
            ability: Ability::WadingBoots,
        }],
    },
    LevelInfo {
        warp_entry_point: ActorId::EntryPoint1,
        warp_lair: WarpLair {
            map_id: MapId::GlFpLobby,
            exit_id: 6,
            map_setup: MapSetupId::GlFpLobby,
            warp_id: WarpOrTriggerId::FpEnterLevel,
        },
        sign_left: TextureId::FpSignLeft,
        sign_right: TextureId::FpSignRight,
        label: [
            TextureId::FpLabelLeft,
            TextureId::FpLabelMiddleLeft,
            TextureId::FpLabelMiddleRight,
            TextureId::FpLabelRight,
        ],
        painting: [
            TextureId::FpPainting00,
            TextureId::FpPainting10,
            TextureId::FpPainting20,
            TextureId::FpPainting30,
            TextureId::FpPainting01,
            TextureId::FpPainting11,
            TextureId::FpPainting21,
            TextureId::FpPainting31,
            TextureId::FpPainting02,
            TextureId::FpPainting12,
            TextureId::FpPainting22,
            TextureId::FpPainting32,
            TextureId::FpPainting03,
            TextureId::FpPainting13,
            TextureId::FpPainting23,
            TextureId::FpPainting33,
        ],
        maps: &[
            MapSetupId::FreezeezyPeak,
            MapSetupId::BoggysIgloo,
            MapSetupId::FpMumbosSkull,
            MapSetupId::ChristmasTree,
            MapSetupId::WozzasCave,
        ],
        molehills: &[Molehill {
            table_index: 0,
            teach_text_id: DialogueId::BottlesLearningBeakBomb,
            refresher_text_id: DialogueId::BottlesBeakBombRefresher,
            ability: Ability::BeakBomb,
        }],
    },
    LevelInfo {
        // lair, bogus values
        warp_entry_point: ActorId::EntryPoint1,
        warp_lair: WarpLair {
            map_id: MapId::SpiralMountain,
            exit_id: 0,
            map_setup: MapSetupId::SpiralMountain,
            warp_id: WarpOrTriggerId::TtcEnterLevel,
        },
        sign_left: TextureId::MmSignLeft,
        sign_right: TextureId::MmSignLeft,
        label: [
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
        ],
        painting: [
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
            TextureId::MmSignLeft,
        ],
        maps: &[],
        molehills: &[],
    },
    LevelInfo {
        warp_entry_point: ActorId::EntryPoint8,
        warp_lair: WarpLair {
            map_id: MapId::GlGvLobby,
            exit_id: 3,
            map_setup: MapSetupId::GlGvLobby,
            warp_id: WarpOrTriggerId::GvEnterLevel,
        },
        sign_left: TextureId::GvSignLeft,
        sign_right: TextureId::GvSignRight,
        label: [
            TextureId::GvLabelLeft,
            TextureId::GvLabelMiddleLeft,
            TextureId::GvLabelMiddleRight,
            TextureId::GvLabelRight,
        ],
        painting: [
            TextureId::GvPainting00,
            TextureId::GvPainting10,
            TextureId::GvPainting20,
            TextureId::GvPainting30,
            TextureId::GvPainting01,
            TextureId::GvPainting11,
            TextureId::GvPainting21,
            TextureId::GvPainting31,
            TextureId::GvPainting02,
            TextureId::GvPainting12,
            TextureId::GvPainting22,
            TextureId::GvPainting32,
            TextureId::GvPainting03,
            TextureId::GvPainting13,
            TextureId::GvPainting23,
            TextureId::GvPainting33,
        ],
        maps: &[
            MapSetupId::GobisValley,
            MapSetupId::MemoryGame,
            MapSetupId::SandybuttsMaze,
            MapSetupId::WaterPyramid,
            MapSetupId::RubeesChamber,
            MapSetupId::InsideJinxy,
            MapSetupId::SnsChamber,
        ],
        molehills: &[Molehill {
            table_index: 8,
            teach_text_id: DialogueId::BottlesLearningTurboTalon,
            refresher_text_id: DialogueId::BottlesTurboTalonRefresher,
            ability: Ability::TurboTalon,
        }],
    },
    LevelInfo {
        warp_entry_point: ActorId::EntryPoint7,
        warp_lair: WarpLair {
            map_id: MapId::GlCcwLobby,
            exit_id: 6,
            map_setup: MapSetupId::GlCcwLobby,
            warp_id: WarpOrTriggerId::CcwEnterLevel,
        },
        sign_left: TextureId::CcwSignLeft,
        sign_right: TextureId::CcwSignRight,
        label: [
            TextureId::CcwLabelLeft,
            TextureId::CcwLabelMiddleLeft,
            TextureId::CcwLabelMiddleRight,
            TextureId::CcwLabelRight,
        ],
        painting: [
            TextureId::CcwPainting00,
            TextureId::CcwPainting10,
            TextureId::CcwPainting20,
            TextureId::CcwPainting30,
            TextureId::CcwPainting01,
            TextureId::CcwPainting11,
            TextureId::CcwPainting21,
            TextureId::CcwPainting31,
            TextureId::CcwPainting02,
            TextureId::CcwPainting12,
            TextureId::CcwPainting22,
            TextureId::CcwPainting32,
            TextureId::CcwPainting03,
            TextureId::CcwPainting13,
            TextureId::CcwPainting23,
            TextureId::CcwPainting33,
        ],
        maps: &[
            MapSetupId::CcwHub,
            MapSetupId::CcwSpring,
            MapSetupId::CcwSummer,
            MapSetupId::CcwAutumn,
            MapSetupId::CcwWinter,
            MapSetupId::CcwSpringMumbosSkull,
            MapSetupId::CcwSummerMumbosSkull,
            MapSetupId::CcwAutumnMumbosSkull,
            MapSetupId::CcwWinterMumbosSkull,
            MapSetupId::CcwSummerZubbaHive,
            MapSetupId::CcwSpringZubbaHive,
            MapSetupId::CcwAutumnZubbaHive,
            MapSetupId::CcwSpringNabnutsHouse,
            MapSetupId::CcwSummerNabnutsHouse,
            MapSetupId::CcwAutumnNabnutsHouse,
            MapSetupId::CcwWinterNabnutsHouse,
            MapSetupId::CcwWinterHoneycombRoom,
            MapSetupId::CcwAutumnNabnutsWaterSupply,
            MapSetupId::CcwWinterNabnutsWaterSupply,
            MapSetupId::CcwSpringWhipcrackRoom,
            MapSetupId::CcwSummerWhipcrackRoom,
            MapSetupId::CcwAutumnWhipcrackRoom,
            MapSetupId::CcwWinterWhipcrackRoom,
        ],
        molehills: &[],
    },
    LevelInfo {
        warp_entry_point: ActorId::EntryPoint16,
        warp_lair: WarpLair {
            map_id: MapId::GlRbbLobby,
            exit_id: 2,
            map_setup: MapSetupId::GlRbbLobby,
            warp_id: WarpOrTriggerId::RbbEnterLevel,
        },
        sign_left: TextureId::RbbSignLeft,
        sign_right: TextureId::RbbSignRight,
        label: [
            TextureId::RbbLabelLeft,
            TextureId::RbbLabelMiddleLeft,
            TextureId::RbbLabelMiddleRight,
            TextureId::RbbLabelRight,
        ],
        painting: [
            TextureId::RbbPainting00,
            TextureId::RbbPainting10,
            TextureId::RbbPainting20,
            TextureId::RbbPainting30,
            TextureId::RbbPainting01,
            TextureId::RbbPainting11,
            TextureId::RbbPainting21,
            TextureId::RbbPainting31,
            TextureId::RbbPainting02,
            TextureId::RbbPainting12,
            TextureId::RbbPainting22,
            TextureId::RbbPainting32,
            TextureId::RbbPainting03,
            TextureId::RbbPainting13,
            TextureId::RbbPainting23,
            TextureId::RbbPainting33,
        ],
        maps: &[
            MapSetupId::RustyBucketBay,
            MapSetupId::EngineRoom,
            MapSetupId::Warehouse,
            MapSetupId::Boathouse,
            MapSetupId::Container1,
            MapSetupId::Container3,
            MapSetupId::CrewCabin,
            MapSetupId::BossBoomBox,
            MapSetupId::StorageRoom,
            MapSetupId::Kitchen,
            MapSetupId::NavigationRoom,
            MapSetupId::Container2,
            MapSetupId::CaptainsCabin,
            MapSetupId::AnchorRoom,
        ],
        molehills: &[],
    },
    LevelInfo {
        warp_entry_point: ActorId::EntryPoint20,
        warp_lair: WarpLair {
            map_id: MapId::GlMmmLobby,
            exit_id: 2,
            map_setup: MapSetupId::GlMmmLobby,
            warp_id: WarpOrTriggerId::MmmEnterLevel,
        },
        sign_left: TextureId::MmmSignLeft,
        sign_right: TextureId::MmmSignRight,
        label: [
            TextureId::MmmLabelLeft,
            TextureId::MmmLabelMiddleLeft,
            TextureId::MmmLabelMiddleRight,
            TextureId::MmmLabelRight,
        ],
        painting: [
            TextureId::MmmPainting00,
            TextureId::MmmPainting10,
            TextureId::MmmPainting20,
            TextureId::MmmPainting30,
            TextureId::MmmPainting01,
            TextureId::MmmPainting11,
            TextureId::MmmPainting21,
            TextureId::MmmPainting31,
            TextureId::MmmPainting02,
            TextureId::MmmPainting12,
            TextureId::MmmPainting22,
            TextureId::MmmPainting32,
            TextureId::MmmPainting03,
            TextureId::MmmPainting13,
            TextureId::MmmPainting23,
            TextureId::MmmPainting33,
        ],
        maps: &[
            MapSetupId::MadMonsterMansion,
            MapSetupId::Church,
            MapSetupId::Cellar,
            MapSetupId::TumblarsShed,
            MapSetupId::Well,
            MapSetupId::NappersRoom,
            MapSetupId::MmmEggRoom,
            MapSetupId::MmmNoteRoom,
            MapSetupId::MmmFeatherRoom,
            MapSetupId::SecretChurchRoom,
            MapSetupId::Bathroom,
            MapSetupId::Bedroom,
            MapSetupId::MmmHoneycombRoom,
            MapSetupId::WaterdrainBarrel,
            MapSetupId::MmmMumbosSkull,
            MapSetupId::InsideLoggo,
        ],
        molehills: &[],
    },
];
